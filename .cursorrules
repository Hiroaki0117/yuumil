# Cursor Rules for Next.js 15 + TypeScript Project (ãƒ¦ãƒ¼ãƒŸãƒ«)

You are an expert Next.js 15, TypeScript, and React developer focused on creating high-performance, accessible, and maintainable code.

## ğŸ¯ Project Context

This is a YouTube video trend discovery application using:
- **Next.js 15** with App Router
- **TypeScript** (strict mode)
- **Tailwind CSS** + **shadcn/ui**
- **Clerk** for authentication
- **Prisma** + **Supabase** for database
- **SWR** for data fetching
- **date-fns** for date utilities

## ğŸ“‹ Core Principles

### 1. **Server Components First**
- Default to Server Components
- Only use `'use client'` when absolutely necessary (user interactions, browser APIs, state management)
- Fetch data on the server side when possible
- Use Suspense boundaries for progressive loading

### 2. **Performance Optimization**
- Use Next.js Image component with proper optimization
- Implement proper caching strategies
- Use dynamic imports for code splitting
- Optimize bundle size and Core Web Vitals

### 3. **TypeScript Best Practices**
- Enable strict mode and use proper typing
- Create interfaces for all props and data structures
- Use type assertions sparingly
- Prefer type-safe patterns over `any`

### 4. **Component Architecture**
- Separate concerns: Server Components for data, Client Components for interactions
- Use composition over inheritance
- Create reusable UI components in `/components/ui/`
- Feature-specific components in `/components/features/`

## ğŸ› ï¸ Code Generation Rules

### **File Structure Patterns**
```
src/
â”œâ”€â”€ app/                    # App Router pages
â”‚   â”œâ”€â”€ (auth)/            # Route groups
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ page.tsx       # Server Component (default)
â”‚   â”‚   â”œâ”€â”€ loading.tsx    # Loading UI
â”‚   â”‚   â”œâ”€â”€ error.tsx      # Error boundary
â”‚   â”‚   â””â”€â”€ layout.tsx     # Nested layout
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                # Reusable UI components
â”‚   â”œâ”€â”€ features/          # Feature-specific components
â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”‚       â”œâ”€â”€ dashboard-client.tsx  # Client components
â”‚   â”‚       â””â”€â”€ dashboard-server.tsx  # Server components
â”‚   â”œâ”€â”€ layout/            # Layout components
â”‚   â””â”€â”€ common/            # Shared components
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ hooks/             # Custom hooks
â”‚   â”œâ”€â”€ utils/             # Utility functions
â”‚   â””â”€â”€ data/              # Data access layer
```

### **Server Components (Default)**
```typescript
// âœ… DO: Server Component with async data fetching
import { auth } from '@clerk/nextjs/server';
import { getUserData } from '@/lib/data/users';

export default async function DashboardPage() {
  const { userId } = await auth();
  const userData = await getUserData(userId);

  return (
    <div>
      <DashboardClient initialData={userData} />
    </div>
  );
}
```

### **Client Components (When Needed)**
```typescript
// âœ… DO: Client Component for interactions
'use client';

import { useState, useEffect } from 'react';

interface ClientComponentProps {
  initialData: UserData;
}

export default function DashboardClient({ initialData }: ClientComponentProps) {
  const [state, setState] = useState(initialData);
  
  // Client-side logic here
  
  return (
    <div>
      {/* Interactive content */}
    </div>
  );
}
```

### **Error Handling**
Always create `error.tsx` and `loading.tsx` for routes:

```typescript
// error.tsx
'use client';

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  return (
    <div className="flex flex-col items-center justify-center min-h-[50vh] space-y-4">
      <h2 className="text-xl font-semibold">å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
      <button onClick={reset} className="px-4 py-2 bg-primary text-primary-foreground rounded">
        å†è©¦è¡Œ
      </button>
    </div>
  );
}
```

### **Loading UI**
```typescript
// loading.tsx
import { Skeleton } from '@/components/ui/skeleton';

export default function Loading() {
  return (
    <div className="space-y-4">
      {Array.from({ length: 5 }).map((_, i) => (
        <Skeleton key={i} className="h-24 w-full" />
      ))}
    </div>
  );
}
```

### **Metadata**
Always include proper metadata for SEO:

```typescript
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ« | ãƒ¦ãƒ¼ãƒŸãƒ«',
  description: 'è©³ç´°ãªèª¬æ˜æ–‡',
  openGraph: {
    title: 'ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«',
    description: 'è©³ç´°ãªèª¬æ˜æ–‡',
  },
};
```

## ğŸ¨ UI/UX Guidelines

### **Tailwind CSS Patterns**
```typescript
// âœ… DO: Consistent spacing and responsive design
<div className="p-4 space-y-6 md:p-8">
  <Button className="
    px-4 py-2 
    bg-primary text-primary-foreground
    hover:bg-primary/90 
    focus:ring-2 focus:ring-primary
    transition-colors
    disabled:opacity-50
  ">
    ãƒœã‚¿ãƒ³
  </Button>
</div>
```

### **Image Optimization**
```typescript
// âœ… DO: Optimized Next.js Image
import Image from 'next/image';

<Image
  src={imageUrl}
  alt="é©åˆ‡ãªèª¬æ˜æ–‡"
  width={168}
  height={94}
  priority={false}
  loading="lazy"
  sizes="(max-width: 768px) 100vw, 168px"
  className="rounded-lg"
/>
```

### **Accessibility**
```typescript
// âœ… DO: Proper ARIA attributes and semantic HTML
<Link
  href="/dashboard"
  className="focus:outline-none focus:ring-2 focus:ring-primary"
  aria-label="ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ç§»å‹•"
>
  <span className="sr-only">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
  <DashboardIcon />
</Link>
```

## ğŸš¨ Avoid Anti-Patterns

### **âŒ DON'T: Unnecessary Client Components**
```typescript
// âŒ DON'T: Using 'use client' for static content
'use client';

export default function StaticPage() {
  return <div>Static content</div>;
}
```

### **âŒ DON'T: Client-side data fetching in Server Components**
```typescript
// âŒ DON'T: useEffect for initial data loading
'use client';
import { useEffect, useState } from 'react';

export default function Page() {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    fetch('/api/data').then(res => res.json()).then(setData);
  }, []);
  
  // Use Server Component instead
}
```

### **âŒ DON'T: Missing error boundaries**
```typescript
// âŒ DON'T: Route without error.tsx and loading.tsx
// Always create both files for better UX
```

## ğŸŒ Internationalization (i18n)

### **Date Formatting**
```typescript
import { formatDistanceToNow } from 'date-fns';
import { ja } from 'date-fns/locale';

const formattedDate = formatDistanceToNow(new Date(publishedAt), {
  addSuffix: true,
  locale: ja
});
```

### **Number Formatting**
```typescript
const formattedViews = (viewCount ?? 0).toLocaleString('ja-JP');
```

## ğŸ”§ Development Tools

### **Type Checking**
Always run TypeScript checks:
```bash
npm run type-check
```

### **Linting**
Follow ESLint rules:
```bash
npm run lint
```

### **Performance Analysis**
```bash
npm run build
npx @next/bundle-analyzer
```

## ğŸ“Š Testing Patterns

### **Component Testing**
```typescript
// Use React Testing Library for component tests
import { render, screen } from '@testing-library/react';
import '@testing-library/jest-dom';

test('renders dashboard', () => {
  render(<Dashboard />);
  expect(screen.getByRole('main')).toBeInTheDocument();
});
```

## ğŸ¯ Specific Instructions

1. **Always prefer Server Components** unless client-side interactivity is required
2. **Use TypeScript strictly** - no `any` types without justification
3. **Include proper error handling** with error.tsx files
4. **Optimize for performance** - lazy loading, caching, bundle optimization
5. **Follow accessibility guidelines** - ARIA attributes, keyboard navigation
6. **Use semantic HTML** - proper heading hierarchy, landmarks
7. **Implement proper loading states** - Skeleton components, Suspense
8. **Include comprehensive metadata** for SEO optimization
9. **Use Japanese locale** for date/number formatting
10. **Follow the established component patterns** and directory structure

## ğŸ’¡ Response Format

When generating code:
1. **Explain the approach** briefly
2. **Show the implementation** with proper TypeScript types
3. **Include accessibility considerations** when applicable
4. **Mention performance implications** if relevant
5. **Use Japanese comments** when appropriate for this project

Remember: Focus on creating maintainable, performant, and accessible code that follows Next.js 15 best practices while providing excellent user experience. 