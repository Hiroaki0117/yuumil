# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Yuumil is a video discovery and recommendation platform built with Next.js 15, featuring personalized video feeds, trending content, and user preference management.

## Git Workflow

### Branch Strategy
- `main` - Production branch (プロダクション)
- `feature/<task-id>` - Feature development (機能開発)
- `hotfix/<issue-id>` - Emergency fixes (緊急修正)

### Commit Guidelines
- Use Conventional Commits format (e.g., `feat:`, `fix:`, `docs:`, `chore:`)
- Write clear, descriptive commit messages

### Pull Request Process
- All changes must go through Pull Request
- Use Squash merge strategy
- Delete branch after merge
- **IMPORTANT**: Always create PR automatically after committing changes using `gh pr create`

## Essential Commands

### Development
```bash
npm run dev        # Start development server with Turbopack
npm run build      # Build for production
npm run start      # Start production server
npm run lint       # Run ESLint
```

### Database
```bash
npx prisma generate    # Generate Prisma client
npx prisma db push     # Push schema changes to database
npx prisma studio      # Open Prisma Studio GUI
```

## Architecture Overview

### Tech Stack
- **Framework**: Next.js 15.3.2 with App Router
- **Language**: TypeScript with strict mode
- **Authentication**: Clerk
- **Database**: Supabase (PostgreSQL) with Prisma ORM
- **UI**: Radix UI primitives + Tailwind CSS
- **State**: SWR for data fetching

### Key Patterns

1. **Server Components by Default**: Use async components for data fetching
```typescript
// Example from src/app/dashboard/page.tsx
export default async function DashboardPage() {
  const user = await currentUser();
  // Direct database access in server components
}
```

2. **Data Access Layer**: All database operations go through `/src/dal/`
```typescript
// Import from DAL, not direct Prisma usage
import { getVideosByGenres } from '@/dal/videos';
```

3. **Component Structure**:
- `/components/ui/` - Base primitives (Button, Card, etc.)
- `/components/features/` - Feature-specific components
- `/components/common/` - Shared components across features
- Client components use `"use client"` directive

4. **API Routes**: Located in `/src/app/api/`
- `/api/videos/trends` - Trending videos
- `/api/videos/news` - News feed
- `/api/auth/sync` - User sync with Clerk

### Environment Setup

Required environment variables (see env.example):
- Supabase credentials (URL, anon key, service role key)
- Clerk authentication keys
- YouTube API key
- Database URLs for Prisma

### Type Safety

- Strict TypeScript configuration
- Type definitions in `/src/types/`
- Database types generated by Prisma
- Use path alias `@/` for imports from `src/`

### Common Development Tasks

When working with videos/content:
- Video data comes from Supabase via DAL functions
- User preferences stored in `user_preferences` table
- Trending data fetched from YouTube API

When adding new features:
1. Create server components when possible
2. Use DAL pattern for database access
3. Add types to `/src/types/`
4. Follow existing component organization