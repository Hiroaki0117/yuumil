<!-- Generated by SpecStory -->

# Next.js ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨UXå‘ä¸Šææ¡ˆ (2025-05-24 06:23:31)

_**User**_

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã®ç¢ºèªã‚’ã—ã¦æ¬²ã—ã„ã€‚
Nexr.jsã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã¤ã„ã¦ç†è§£ã—ãŸä¸Šã§ã€ã©ã®ã‚ˆã†ãªä¿®æ­£ã‚’ã™ã‚‹ã¨ã‚ˆã‚ŠUXä½“é¨“ãŒå‘ä¸Šã™ã‚‹ã‹ã‚’æ•™ãˆã¦æ¬²ã—ã„ã€‚
ä¾‹ãˆã°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãªã‚‹ã¹ãæ¸›ã‚‰ã—ã€ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ç½®ãæ›ãˆã‚‹ç­‰ã€‚
@Next.js 
@https://zenn.dev/akfm/books/nextjs-basic-principle 

---

_**Assistant**_



---

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€Next.jsã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã„ã¦UXä½“é¨“ã‚’å‘ä¸Šã•ã›ã‚‹ä¿®æ­£ç‚¹ã‚’ææ¡ˆã„ãŸã—ã¾ã™ã€‚ã¾ãšã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ã‚’ç¢ºèªã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚

---

<details>
            <summary>Listed current directory â€¢ **24** results</summary>
        
| Name |
|-------|
| ğŸ“ `.git` |
| ğŸ“ `docs` |
| ğŸ“„ `.gitignore` |
| ğŸ“„ `.cursorindexingignore` |
| ğŸ“ `.specstory` |
| ğŸ“„ `env.example` |
| ğŸ“ `src` |
| ğŸ“„ `sample.csv` |
| ğŸ“ `.next` |
| ğŸ“ `.cursor` |
| ğŸ“„ `package-lock.json` |
| ğŸ“ `node_modules` |
| ğŸ“ `supabase` |
| ğŸ“„ `package.json` |
| ğŸ“„ `next.config.ts` |
| ğŸ“ `prisma` |
| ğŸ“ `.vscode` |
| ğŸ“„ `next-env.d.ts` |
| ğŸ“„ `tsconfig.json` |
| ğŸ“ `public` |
| ğŸ“„ `postcss.config.mjs` |
| ğŸ“„ `README.md` |
| ğŸ“„ `components.json` |
| ğŸ“„ `eslint.config.mjs` |

</details>

---

Next.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚`src`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãã®ä»–ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

---

Read file: package.json

---

æ¬¡ã«ã€`src`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ§‹é€ ã‚’ç¢ºèªã—ã¾ã™ã€‚

---

<details>
            <summary>Listed directory src â€¢ **7** results</summary>
        
| Name |
|-------|
| ğŸ“„ `middleware.ts` |
| ğŸ“ `components` |
| ğŸ“ `lib` |
| ğŸ“„ `type.ts` |
| ğŸ“ `types` |
| ğŸ“ `dal` |
| ğŸ“ `app` |

</details>

---

`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆApp Routerï¼‰ã®æ§‹é€ ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

<details>
            <summary>Listed directory src/app â€¢ **10** results</summary>
        
| Name |
|-------|
| ğŸ“„ `layout.tsx` |
| ğŸ“ `api` |
| ğŸ“„ `page.tsx` |
| ğŸ“ `trends` |
| ğŸ“„ `globals.css` |
| ğŸ“ `onboarding` |
| ğŸ“ `dashboard` |
| ğŸ“ `(marketing)` |
| ğŸ“ `profile` |
| ğŸ“„ `favicon.ico` |

</details>

---

`components`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ§‹é€ ã‚‚ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

<details>
            <summary>Listed directory src/components â€¢ **6** results</summary>
        
| Name |
|-------|
| ğŸ“ `common` |
| ğŸ“ `forms` |
| ğŸ“ `features` |
| ğŸ“ `ui` |
| ğŸ“ `marketing` |
| ğŸ“ `layout` |

</details>

---

ä¸»è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã€ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³ã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚ã¾ãšã€ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç¢ºèªã—ã¾ã™ã€‚

---

Read file: src/app/layout.tsx

---

æ¬¡ã«ã€ä¸€äº›ä¸»è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç¢ºèªã—ã¾ã™ã€‚ã¾ãšã€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

Read file: src/components/layout/header.tsx

---

`ModeToggle`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã€ã„ãã¤ã‹ã®ä¸»è¦ãªãƒšãƒ¼ã‚¸ã‚‚ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

Read file: src/components/layout/mode-toggle.tsx

---

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã‚‚ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

<details>
            <summary>Listed directory src/app/dashboard â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“„ `page.tsx` |

</details>

---

Read file: src/app/dashboard/page.tsx

---

æ¬¡ã«ã€`useVideoFeed`ãƒ•ãƒƒã‚¯ã¨`VideoCard`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

Read file: src/lib/hooks/useVideoFeed.ts

---

Read file: src/components/features/videos/video-card.tsx

---

ã„ãã¤ã‹ã®APIãƒ«ãƒ¼ãƒˆã‚‚ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

<details>
            <summary>Listed directory src/app/api â€¢ **5** results</summary>
        
| Name |
|-------|
| ğŸ“ `health` |
| ğŸ“ `auth` |
| ğŸ“ `users` |
| ğŸ“ `videos` |
| ğŸ“ `tags` |

</details>

---

Read file: src/app/api/tags/route.ts

---

`dal`ï¼ˆData Access Layerï¼‰ã‚‚ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

<details>
            <summary>Listed directory src/dal â€¢ **3** results</summary>
        
| Name |
|-------|
| ğŸ“„ `videos.ts` |
| ğŸ“„ `genre.ts` |
| ğŸ“„ `users.ts` |

</details>

---

Next.jsã®è¨­å®šã‚‚ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

Read file: next.config.ts

---

Read file: src/components/common/theme-provider.tsx

---

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãŸçµæœã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ”¹å–„ç‚¹ã‚’Next.jsã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã„ã¦ææ¡ˆã„ãŸã—ã¾ã™ï¼š

## ğŸš€ Next.jsãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ãæ”¹å–„ææ¡ˆ

### 1. **Server Componentsã®æ´»ç”¨ã«ã‚ˆã‚‹æœ€é©åŒ–**

ç¾åœ¨ã€å¤šãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä¸å¿…è¦ã«`'use client'`ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®æ”¹å–„ãŒå¯èƒ½ã§ã™ï¼š

#### **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã®æ”¹å–„**
`src/app/dashboard/page.tsx`ã‚’ Server Component ã«å¤‰æ›ï¼š

```tsx:src/app/dashboard/page.tsx
import { Suspense } from 'react';
import { auth } from '@clerk/nextjs/server';
import { listUserPreferencesByClerkId } from '@/dal/users';
import DashboardClient from '@/components/features/dashboard/dashboard-client';
import { Skeleton } from "@/components/ui/skeleton";

export default async function Page() {
  const { userId: clerkId } = await auth();
  
  if (!clerkId) {
    return <div>èªè¨¼ãŒå¿…è¦ã§ã™</div>;
  }

  // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const prefs = await listUserPreferencesByClerkId(clerkId);

  return (
    <div className="p-4 space-y-6">
      <Suspense fallback={<DashboardSkeleton />}>
        <DashboardClient initialPrefs={prefs} />
      </Suspense>
    </div>
  );
}

function DashboardSkeleton() {
  return (
    <div className="space-y-6">
      {Array.from({ length: 3 }).map((_, i) => (
        <Skeleton key={i} className="h-40 w-full" />
      ))}
    </div>
  );
}
```

#### **VideoCardã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ”¹å–„**
`VideoCard`ã¯æ—¢ã«Server Componentã¨ã—ã¦æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã•ã‚‰ã«æœ€é©åŒ–å¯èƒ½ï¼š

```tsx:src/components/features/videos/video-card.tsx
import Image from 'next/image';
import { formatDistanceToNow } from 'date-fns';
import Link from 'next/link';
import { ja } from 'date-fns/locale';

interface Props {
  video: {
    id: string;
    youtube_id: string;
    title: string;
    thumbnail_url: string;
    published_at: string;
    total_views: number | null;
  };
}

export default function VideoCard({ video }: Props) {
  const thumb = video.thumbnail_url || '/images/no-thumb.png';

  return (
    <Link 
      href={`https://www.youtube.com/watch?v=${video.youtube_id}`}
      target="_blank"
      className="flex gap-3 border rounded-lg p-3 hover:bg-accent transition-colors"
    >
      <Image
        src={thumb}
        alt={video.title}
        width={168}
        height={94}
        className="rounded-lg shrink-0"
        priority={false}
        loading="lazy"
        sizes="(max-width: 768px) 100vw, 168px"
      />
      <div className="flex flex-col justify-between min-w-0">
        <h3 className="text-sm font-semibold line-clamp-2">{video.title}</h3>
        <div className="text-xs text-muted-foreground flex gap-2">
          <span>{(video.total_views ?? 0).toLocaleString()} å›è¦–è´</span>
          <span>Â·</span>
          <span>
            {formatDistanceToNow(new Date(video.published_at), { 
              addSuffix: true, 
              locale: ja 
            })}
          </span>
        </div>
      </div>
    </Link>
  );
}
```

### 2. **Header ã®æœ€é©åŒ–**

ç¾åœ¨ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’éƒ¨åˆ†çš„ã« Server Component ã«åˆ†é›¢ï¼š

```tsx:src/components/layout/header.tsx
import Link from 'next/link';
import { auth } from '@clerk/nextjs/server';
import HeaderClient from './header-client';
import { Suspense } from 'react';

export default async function Header() {
  const { userId } = await auth();

  return (
    <header className="fixed inset-x-0 top-0 z-50 h-16 border-b bg-background/80 backdrop-blur">
      <div className="flex h-full items-center justify-between px-4 md:px-8">
        <Link href="/" className="text-xl font-bold">ãƒ¦ãƒ¼ãƒŸãƒ«</Link>

        <nav className="hidden md:flex gap-6 text-sm font-medium">
          <Link href="/dashboard">ãƒ•ã‚£ãƒ¼ãƒ‰</Link>
          <Link href="/trends">ãƒˆãƒ¬ãƒ³ãƒ‰</Link>
          <Link href="/profile">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</Link>
        </nav>

        <Suspense fallback={<div className="w-24 h-8 bg-muted animate-pulse rounded" />}>
          <HeaderClient isAuthenticated={!!userId} />
        </Suspense>
      </div>
    </header>
  );
}
```

```tsx:src/components/layout/header-client.tsx
'use client';

import { UserButton, SignedIn, SignedOut, SignInButton } from '@clerk/nextjs';
import { ModeToggle } from './mode-toggle';

interface HeaderClientProps {
  isAuthenticated: boolean;
}

export default function HeaderClient({ isAuthenticated }: HeaderClientProps) {
  return (
    <div className="flex items-center gap-4">
      <ModeToggle />
      
      {!isAuthenticated ? (
        <SignInButton>
          <button className="px-3 py-1 rounded bg-primary text-white">
            Sign In
          </button>
        </SignInButton>
      ) : (
        <SignedIn>
          <UserButton afterSignOutUrl="/" />
        </SignedIn>
      )}
    </div>
  );
}
```

### 3. **Loading UI ã¨Streaming ã®æ”¹å–„**

å„ãƒšãƒ¼ã‚¸ã«é©åˆ‡ãª`loading.tsx`ã‚’è¿½åŠ ï¼š

```tsx:src/app/dashboard/loading.tsx
import { Skeleton } from "@/components/ui/skeleton";

export default function Loading() {
  return (
    <div className="p-4 space-y-6">
      {/* ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³ */}
      <div className="flex gap-3">
        {Array.from({ length: 3 }).map((_, i) => (
          <Skeleton key={i} className="h-8 w-20" />
        ))}
      </div>
      
      {/* å‹•ç”»ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³ */}
      {Array.from({ length: 5 }).map((_, i) => (
        <Skeleton key={i} className="h-24 w-full" />
      ))}
    </div>
  );
}
```

### 4. **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®æœ€é©åŒ–**

å‹•çš„ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚’è¿½åŠ ï¼š

```tsx:src/app/dashboard/page.tsx
import type { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | ãƒ¦ãƒ¼ãƒŸãƒ«',
  description: 'ã‚ãªãŸã®èˆˆå‘³ã«åŸºã¥ã„ãŸYouTubeå‹•ç”»ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¡¨ç¤º',
  openGraph: {
    title: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | ãƒ¦ãƒ¼ãƒŸãƒ«',
    description: 'ã‚ãªãŸã®èˆˆå‘³ã«åŸºã¥ã„ãŸYouTubeå‹•ç”»ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¡¨ç¤º',
    type: 'website',
  },
};
```

### 5. **ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã®æœ€é©åŒ–**

Request Memoization ã‚’æ´»ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ï¼š

```tsx:src/lib/data/users.ts
import { unstable_cache } from 'next/cache';
import { listUserPreferencesByClerkId as _listUserPreferencesByClerkId } from '@/dal/users';

export const getUserPreferences = unstable_cache(
  async (clerkId: string) => {
    return _listUserPreferencesByClerkId(clerkId);
  },
  ['user-preferences'],
  {
    tags: ['user-preferences'],
    revalidate: 3600, // 1æ™‚é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  }
);
```

### 6. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„**

```tsx:src/app/dashboard/error.tsx
'use client';

import { useEffect } from 'react';
import { Button } from '@/components/ui/button';

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  useEffect(() => {
    console.error(error);
  }, [error]);

  return (
    <div className="flex flex-col items-center justify-center min-h-[50vh] space-y-4">
      <h2 className="text-xl font-semibold">ä½•ã‹å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
      <p className="text-muted-foreground">å‹•ç”»ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>
      <Button onClick={reset}>å†è©¦è¡Œ</Button>
    </div>
  );
}
```

### 7. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**

#### Bundle Analyzerã®è¿½åŠ 
```bash
npm install @next/bundle-analyzer
```

```tsx:next.config.ts
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
});

const nextConfig = {
  // ... æ—¢å­˜ã®è¨­å®š
};

module.exports = withBundleAnalyzer(nextConfig);
```

#### Dynamic Importsã®æ´»ç”¨
```tsx
import dynamic from 'next/dynamic';

const VideoPlayer = dynamic(() => import('@/components/features/videos/video-player'), {
  loading: () => <div className="animate-pulse bg-muted h-48 rounded" />,
  ssr: false,
});
```

### 8. **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã®æ”¹å–„**

```tsx:src/components/features/videos/video-card.tsx
// WAI-ARIAã®æ”¹å–„
<div 
  className="flex gap-3 border rounded-lg p-3 hover:bg-accent transition-colors"
  role="article"
  aria-label={`å‹•ç”»: ${video.title}`}
>
  <Image
    src={thumb}
    alt=""  // è£…é£¾çš„ãªç”»åƒãªã®ã§ç©ºã®alt
    width={168}
    height={94}
    className="rounded-lg shrink-0"
    loading="lazy"
  />
  // ...
</div>
```

## ğŸ¯ UXå‘ä¸Šã®ãŸã‚ã®ä¸»è¦ãªæ”¹å–„åŠ¹æœ

1. **åˆæœŸèª­ã¿è¾¼ã¿é€Ÿåº¦ã®å‘ä¸Š**: Server Componentsã«ã‚ˆã‚Šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®JavaScriptãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå‰Šæ¸›
2. **SEOã®æ”¹å–„**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³æœ€é©åŒ–
3. **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä½“é¨“**: Suspenseã¨ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã«ã‚ˆã‚‹æ®µéšçš„ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤º
4. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡**: Next.js 15ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’æœ€å¤§é™æ´»ç”¨
5. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š

ã“ã‚Œã‚‰ã®æ”¹å–„ã«ã‚ˆã‚Šã€[Next.jsã®å…¬å¼ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](https://nextjs.org/docs/app/building-your-application/optimizing)ã¨[Zennã®è¨˜äº‹](https://zenn.dev/akfm/books/nextjs-basic-principle)ã§æ¨å¥¨ã•ã‚Œã¦ã„ã‚‹è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«æ²¿ã£ãŸã€ã‚ˆã‚Šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é«˜ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãªã‚Šã¾ã™ã€‚

---

_**User**_

ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
å®Ÿéš›ã«ä¿®æ­£ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚

---

_**Assistant**_



---

å®Ÿéš›ã«ä¿®æ­£ã‚’é©ç”¨ã„ãŸã—ã¾ã™ã€‚Next.jsã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ã„ã¦ã€æ®µéšçš„ã«æ”¹å–„ã—ã¦ã„ãã¾ã™ã€‚

ã¾ãšã€`VideoCard`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ”¹å–„ã—ã¾ã™ï¼š

---

```diff
  import Image from 'next/image';
  import { formatDistanceToNow } from 'date-fns';
+ import { ja } from 'date-fns/locale';
+ import Link from 'next/link';
  
  interface Props {
```

```diff
  
    return (
-     <div className="flex gap-3 border rounded-lg p-3" data-video-card>
+     <Link 
+       href={`https://www.youtube.com/watch?v=${video.youtube_id}`}
+       target="_blank"
+       rel="noopener noreferrer"
+       className="flex gap-3 border rounded-lg p-3 hover:bg-accent transition-colors focus:outline-none focus:ring-2 focus:ring-primary"
+       aria-label={`å‹•ç”»ã‚’è¦–è´: ${video.title}`}
+     >
        <Image
          src={thumb}
-         alt={video.title}
+         alt=""
          width={168}
          height={94}
          className="rounded-lg shrink-0"
+         priority={false}
+         loading="lazy"
+         sizes="(max-width: 768px) 100vw, 168px"
        />
        <div className="flex flex-col justify-between min-w-0">
          <h3 className="text-sm font-semibold line-clamp-2">{video.title}</h3>
          <div className="text-xs text-muted-foreground flex gap-2">
-           <span>{video.total_views ?? 0} views</span>
+           <span>{(video.total_views ?? 0).toLocaleString('ja-JP')} å›è¦–è´</span>
            <span>Â·</span>
-           <span>{formatDistanceToNow(new Date(video.published_at), { addSuffix: true })}</span>
+           <span>
+             {formatDistanceToNow(new Date(video.published_at), { 
+               addSuffix: true, 
+               locale: ja 
+             })}
+           </span>
          </div>
        </div>
-     </div>
+     </Link>
    );
  }
```

---

æ¬¡ã«ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

---

```diff
- 
+ 'use client';
+ 
+ import { Skeleton } from "@/components/ui/skeleton";
+ import VideoCard from "@/components/features/videos/video-card";
+ import { useVideoFeed } from "@/lib/hooks/useVideoFeed";
+ import { Pref } from "@/types";
+ import { ToggleGroup, ToggleGroupItem } from "@radix-ui/react-toggle-group";
+ import { useEffect, useRef, useState } from "react";
+ 
+ interface DashboardClientProps {
+   initialPrefs: Pref[];
+ }
+ 
+ export default function DashboardClient({ initialPrefs }: DashboardClientProps) {
+   const [activePref, setActivePref] = useState("");
+ 
+   // å‹•ç”»ãƒªã‚¹ãƒˆå–å¾—
+   const { items, setSize, isLoadingMore } = useVideoFeed(activePref);
+   const sentinel = useRef<HTMLDivElement>(null);
+ 
+   // sentinelã®ç›£è¦–ï¼ˆç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰
+   useEffect(() => {
+     if (!sentinel.current) return;
+     const io = new IntersectionObserver(
+       (entries) => {
+         if (entries[0].isIntersecting) {
+           setSize(prev => prev + 1);
+         }
+       },
+       { threshold: 0.1 }
+     );
+     io.observe(sentinel.current);
+     return () => io.disconnect();
+   }, [setSize]);
+ 
+   // åˆå›ã®ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªå‹•é¸æŠ
+   useEffect(() => {
+     if (initialPrefs && initialPrefs.length && !activePref) {
+       const firstPref = initialPrefs[0];
+       setActivePref(`${firstPref.type}:${firstPref.id}`);
+     }
+   }, [initialPrefs, activePref]);
+ 
+   if (!initialPrefs.length) {
+     return (
+       <div className="text-center py-12">
+         <p className="text-muted-foreground">
+           è¨­å®šã‹ã‚‰ã‚¸ãƒ£ãƒ³ãƒ«ã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
+         </p>
+       </div>
+     );
+   }
+ 
+   return (
+     <>
+       {/* ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ */}
+       <ToggleGroup 
+         type="single" 
+         value={activePref} 
+         onValueChange={setActivePref} 
+         className="flex flex-wrap gap-3"
+       >
+         {initialPrefs.map((pref) => (
+           <ToggleGroupItem 
+             key={`${pref.type}:${pref.id}`} 
+             value={`${pref.type}:${pref.id}`} 
+             className="px-4 py-2 rounded-full border data-[state=on]:bg-primary data-[state=on]:text-primary-foreground"
+             aria-label={`${pref.label}ã®ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¡¨ç¤º`}
+           >
+             {pref.label}
+           </ToggleGroupItem>
+         ))}
+       </ToggleGroup>
+ 
+       {/* å‹•ç”»ãƒªã‚¹ãƒˆ */}
+       <div className="space-y-4">
+         {items.length === 0 && !isLoadingMore ? (
+           <div className="text-center py-8">
+             <p className="text-muted-foreground">å‹•ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
+           </div>
+         ) : (
+           items.map((video) => (
+             <VideoCard key={video.id} video={video} />
+           ))
+         )}
+ 
+         {/* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚±ãƒ«ãƒˆãƒ³ */}
+         {isLoadingMore && (
+           <div className="space-y-4">
+             {Array.from({ length: 3 }).map((_, i) => (
+               <Skeleton key={i} className="h-24 w-full" />
+             ))}
+           </div>
+         )}
+ 
+         {/* ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”¨ã®ã‚»ãƒ³ãƒãƒãƒ« */}
+         <div ref={sentinel} className="h-4" aria-hidden="true" />
+       </div>
+     </>
+   );
+ } 
```

---

æ¬¡ã«ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã‚’ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¤‰æ›ã—ã¾ã™ï¼š

---

```diff
- 'use client'
- 
+ import { Suspense } from 'react';
+ import { auth } from '@clerk/nextjs/server';
+ import { listUserPreferencesByClerkId } from '@/dal/users';
+ import DashboardClient from '@/components/features/dashboard/dashboard-client';
  import { Skeleton } from "@/components/ui/skeleton";
- import VideoCard from "@/components/features/videos/video-card";
- import { useVideoFeed } from "@/lib/hooks/useVideoFeed";
- import { Pref } from "@/types";
- import { ToggleGroup, ToggleGroupItem } from "@radix-ui/react-toggle-group";
- import { useEffect, useRef, useState } from "react";
- import useSWR from "swr";
+ import type { Metadata } from 'next';
  
- export default function Page() {
-   // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ãƒªã‚¹ãƒˆã‚’å–å¾—
-   const fetcher = (url: string): Promise<Pref[]> => fetch(url).then(res => res.json());
-   const { data: prefs } = useSWR<Pref[]>('api/tags', fetcher);
-   const [activePref, setActivePref] = useState("");
- 
-   // å‹•ç”»ãƒªã‚¹ãƒˆå–å¾—
-   const { items, setSize, isLoadingMore } = useVideoFeed(activePref);
-   const sentinel = useRef<HTMLDivElement>(null);
- 
-   // sentinelã®ç›£è¦– 
-   useEffect(() => {
-     if (!sentinel.current) return;
-     const io = new IntersectionObserver(e => {
-       if (e[0].isIntersecting) setSize(prev => prev + 1);
-     });
-     io.observe(sentinel.current);
-     return () => io.disconnect();
-   }, [setSize]);
- 
-   // åˆå›ã®ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªå‹•é¸æŠ
-   useEffect(() => {
-     if (prefs && prefs.length && !activePref) {
-       const p = prefs[0];
-       setActivePref(`${p.type}:${p.id}`);
-     }
-   }, [prefs, activePref])
+ export const metadata: Metadata = {
+   title: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | ãƒ¦ãƒ¼ãƒŸãƒ«',
+   description: 'ã‚ãªãŸã®èˆˆå‘³ã«åŸºã¥ã„ãŸYouTubeå‹•ç”»ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¡¨ç¤º',
+   openGraph: {
+     title: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | ãƒ¦ãƒ¼ãƒŸãƒ«',
+     description: 'ã‚ãªãŸã®èˆˆå‘³ã«åŸºã¥ã„ãŸYouTubeå‹•ç”»ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’è¡¨ç¤º',
+     type: 'website',
+   },
+ };
+ 
+ function DashboardSkeleton() {
    return (
      <div className="p-4 space-y-6">
-       {/* ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ */}
-       {(prefs && prefs.length) && (
-         <ToggleGroup type="single" value={activePref} onValueChange={setActivePref} className="flex gap-3">
-           {prefs.map((pref) => (
-             <ToggleGroupItem key={`${pref.type}:${pref.id}`} value={`${pref.type}:${pref.id}`} className="px-4 py-1 rounded-full">
-               {pref.label}
-             </ToggleGroupItem>
-           ))}
-         </ToggleGroup>
-       )}
- 
-       {items.map((v) => (
-         
-         <VideoCard key={v.id} video={v} data-video-card />
-       ))}
- 
-       {/* Skeleton */}
-       {isLoadingMore && Array.from({ length: 3 }).map((_, i) => <Skeleton key={i} className="h-40 w-full" />)}
- 
-       <div ref={sentinel} className="h-4" />
+       {/* ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³ */}
+       <div className="flex gap-3">
+         {Array.from({ length: 3 }).map((_, i) => (
+           <Skeleton key={i} className="h-10 w-20" />
+         ))}
+       </div>
+       
+       {/* å‹•ç”»ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³ */}
+       <div className="space-y-4">
+         {Array.from({ length: 5 }).map((_, i) => (
+           <Skeleton key={i} className="h-24 w-full" />
+         ))}
+       </div>
+     </div>
+   );
+ }
+ 
+ export default async function DashboardPage() {
+   const { userId: clerkId } = await auth();
+   
+   if (!clerkId) {
+     return (
+       <div className="flex items-center justify-center min-h-[50vh]">
+         <div className="text-center space-y-4">
+           <h1 className="text-2xl font-bold">èªè¨¼ãŒå¿…è¦ã§ã™</h1>
+           <p className="text-muted-foreground">
+             ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„
+           </p>
+         </div>
+       </div>
+     );
+   }
+ 
+   // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨­å®šã‚’å–å¾—
+   const prefs = await listUserPreferencesByClerkId(clerkId);
+ 
+   return (
+     <div className="p-4 space-y-6">
+       <Suspense fallback={<DashboardSkeleton />}>
+         <DashboardClient initialPrefs={prefs} />
+       </Suspense>
      </div>
    );
```

---



---

