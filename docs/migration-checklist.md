# プロジェクト移行チェックリスト

このドキュメントは、既存の Next.js プロジェクトを推奨される構造に移行するための詳細なチェックリストです。

## 📋 移行前の準備

### 1. バックアップとブランチ作成

- [ ] 現在のプロジェクトをバックアップ
- [ ] 新しいブランチを作成 (`git checkout -b refactor/project-structure`)
- [ ] `.gitignore` を確認・更新

### 2. 現状の把握

- [ ] 現在のディレクトリ構造をドキュメント化
- [ ] 依存関係の確認 (`npm ls` または `yarn list`)
- [ ] 使用している技術スタックの整理
- [ ] 型定義ファイルの現在の場所を確認

## 🚀 高優先度タスク

### 1. 型定義の統合

#### ディレクトリ作成

```bash
mkdir -p src/types
```

- [ ] `src/types/` ディレクトリ作成
- [ ] `src/types/index.ts` 作成
- [ ] `src/types/database.ts` 作成（既存 DB 型を移動）
- [ ] `src/types/api.ts` 作成

#### ファイル移行

- [ ] 既存の型定義ファイルを特定
  - [ ] `types.ts`, `type.ts` 等
  - [ ] `database.types.ts` 等
  - [ ] インターフェース定義ファイル
- [ ] 型定義を機能別に分類
  - [ ] データベース関連 → `database.ts`
  - [ ] API 関連 → `api.ts`
  - [ ] UI 関連 → `ui.ts`
- [ ] `src/types/index.ts` で一括エクスポート

#### インポート修正

- [ ] 全ファイルのインポート文を検索・置換
  ```bash
  # 例: VS Codeの一括置換
  # 検索: from ['"].*types.*['"]
  # 置換: from '@/types'
  ```
- [ ] TypeScript のエラーチェック
  ```bash
  npm run type-check
  ```

### 2. 環境変数ファイルの整備

- [ ] `.env.example` ファイル作成
- [ ] 必要な環境変数をリストアップ
  - [ ] データベース接続情報
  - [ ] 認証サービス設定
  - [ ] 外部 API キー
  - [ ] アプリケーション設定
- [ ] セキュリティ情報の確認（秘密鍵等は除外）
- [ ] README.md に環境設定手順を追加

## 🔧 中優先度タスク

### 1. コンポーネントの細分化

#### ディレクトリ構造作成

```bash
mkdir -p src/components/{ui,common,forms,features,layout}
```

- [ ] 新しいディレクトリ構造を作成
- [ ] 既存コンポーネントの分類

#### コンポーネント移行

- [ ] **UI コンポーネント** (`src/components/ui/`)
  - [ ] Button, Input, Card 等のプリミティブコンポーネント
  - [ ] Shadcn/ui 等のライブラリコンポーネント
- [ ] **共通コンポーネント** (`src/components/common/`)
  - [ ] テーマプロバイダー
  - [ ] エラーバウンダリー
  - [ ] ローディングスピナー
  - [ ] 認証ガード
- [ ] **フォームコンポーネント** (`src/components/forms/`)
  - [ ] ログインフォーム
  - [ ] 登録フォーム
  - [ ] バリデーション付きインプット
- [ ] **機能固有コンポーネント** (`src/components/features/`)
  - [ ] 各機能ごとにディレクトリ作成
  - [ ] ページ固有のコンポーネント移動
- [ ] **レイアウトコンポーネント** (`src/components/layout/`)
  - [ ] ヘッダー、フッター
  - [ ] サイドバー、ナビゲーション

#### インポート修正

- [ ] 全ファイルのコンポーネントインポートを更新
- [ ] TypeScript エラーの解消
- [ ] コンポーネントの動作確認

### 2. ユーティリティの整理

#### ディレクトリ作成

```bash
mkdir -p src/lib/{constants,validations,auth,database,hooks}
```

- [ ] 機能別ディレクトリ作成

#### ファイル移行・作成

- [ ] **定数ファイル** (`src/lib/constants/`)
  - [ ] `index.ts` 作成
  - [ ] アプリケーション設定
  - [ ] API エンドポイント
  - [ ] エラーメッセージ
- [ ] **バリデーション** (`src/lib/validations/`)
  - [ ] `index.ts` 作成
  - [ ] フォームバリデーション関数
  - [ ] 型ガード関数
- [ ] **認証関連** (`src/lib/auth/`)
  - [ ] `index.ts` 作成
  - [ ] 認証ユーティリティ
  - [ ] 権限チェック関数
- [ ] **データベース関連** (`src/lib/database/`)
  - [ ] 既存の DB クライアントファイル移動
  - [ ] クエリビルダー等

#### 既存ユーティリティの移行

- [ ] `utils.ts`, `helpers.ts` 等の既存ファイルを確認
- [ ] 機能別に分類して適切なディレクトリに配置
- [ ] 重複する機能の統合

### 3. API ルートの整理

#### ディレクトリ構造作成

```bash
mkdir -p src/app/api/{auth,users,health}
```

- [ ] 機能別 API ディレクトリ作成

#### API 移行・整理

- [ ] **認証 API** (`src/app/api/auth/`)
  - [ ] ログイン、ログアウト
  - [ ] ユーザー登録
  - [ ] トークン更新
- [ ] **ユーザー管理 API** (`src/app/api/users/`)
  - [ ] CRUD 操作
  - [ ] プロフィール管理
- [ ] **システム API** (`src/app/api/health/`)
  - [ ] ヘルスチェック
  - [ ] システム情報

#### API 設計の改善

- [ ] エラーハンドリングの統一
- [ ] レスポンス形式の統一
- [ ] バリデーションの追加
- [ ] 適切な HTTP ステータスコードの使用

## 📝 低優先度タスク

### 1. 静的アセットの整理

- [ ] `public/` ディレクトリの整理
  ```
  public/
  ├── icons/
  ├── images/
  ├── fonts/
  └── favicon.ico
  ```

### 2. テスト環境の構築

- [ ] Jest の設定
- [ ] テスト用ディレクトリ作成
  ```bash
  mkdir -p src/__tests__/{components,lib,app}
  ```
- [ ] サンプルテストの作成

### 3. ドキュメントの整備

- [ ] README.md の更新
- [ ] API 仕様書の作成
- [ ] コンポーネントドキュメントの作成

## ✅ 移行後の確認事項

### 1. 動作確認

- [ ] 開発サーバーの起動確認
  ```bash
  npm run dev
  ```
- [ ] ビルドの成功確認
  ```bash
  npm run build
  ```
- [ ] TypeScript エラーがないことを確認
  ```bash
  npm run type-check
  ```
- [ ] Lint エラーがないことを確認
  ```bash
  npm run lint
  ```

### 2. 機能テスト

- [ ] 認証機能の動作確認
- [ ] ページ遷移の確認
- [ ] API 呼び出しの確認
- [ ] フォーム送信の確認
- [ ] ファイルアップロード等の特殊機能

### 3. パフォーマンステスト

- [ ] ページロード時間の確認
- [ ] バンドルサイズの確認
- [ ] Core Web Vitals の測定

## 🔄 段階的移行戦略

### フェーズ 1: 基盤整備（1-2 日）

1. 型定義の統合
2. 環境変数ファイルの整備
3. 基本的なディレクトリ構造の作成

### フェーズ 2: コンポーネント整理（2-3 日）

1. UI コンポーネントの移行
2. 共通コンポーネントの抽出
3. 機能固有コンポーネントの分離

### フェーズ 3: ユーティリティ整理（1-2 日）

1. 定数・設定の一元化
2. バリデーション関数の整備
3. 認証・データベースユーティリティの整理

### フェーズ 4: API 整理（1 日）

1. API ルートの機能別分類
2. エラーハンドリングの統一
3. ヘルスチェックの追加

### フェーズ 5: 仕上げ・最適化（1 日）

1. テスト実行・修正
2. ドキュメント更新
3. パフォーマンス確認

## 🚨 よくある問題と対処法

### 1. インポートエラー

**問題**: モジュールが見つからない
**対処法**:

- パスマップ設定の確認
- ファイルの実際の場所を確認
- 相対パスから絶対パスへの変更

### 2. 循環参照エラー

**問題**: 循環参照によるビルドエラー
**対処法**:

- 依存関係の見直し
- 共通の型定義を別ファイルに分離
- バレルエクスポートの最適化

### 3. TypeScript エラー

**問題**: 型定義の不整合
**対処法**:

- 型定義の再エクスポート確認
- `any` 型の一時的使用（後で修正）
- 段階的な型定義の修正

### 4. パフォーマンス低下

**問題**: バンドルサイズの増加
**対処法**:

- 動的インポートの活用
- 不要なライブラリの削除
- Tree shaking の最適化

## 📚 参考リソース

- [Next.js プロジェクト構造ガイド](./project-structure-guide.md)
- [実装例とテンプレート](./implementation-examples.md)
- [Next.js 公式ドキュメント](https://nextjs.org/docs)
- [TypeScript ベストプラクティス](https://typescript-eslint.io/)

---

このチェックリストを参考に、段階的にプロジェクト構造を改善してください。
